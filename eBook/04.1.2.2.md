# 4.1.2.2 gRPC快速入门

## 快速入门

gRPC是Google公司基于Protobuf开发的跨语言的开源RPC框架。gRPC基于HTTP/2协议设计，可以基于一个HTTP/2链接提供多个服务，对于移动设备更加友好。

### 编写proto文件

gRPC离不开protobuf技术，所以还是先编写proto文件。

```code
syntax = "proto3";

option go_package = "./;main";
package main;

message String {
  string value = 1;
}
service HelloService {
  rpc Hello (String) returns (String);
}

```

### 自动化生成proto.go代码

与之前的步骤，不同需要增加grpc参数。

```bash
.\protoc --go_out=plugins=grpc:. hello.proto
```

可以看到自动生成rpc接口。

```code
// HelloServiceServer is the server API for HelloService service.
type HelloServiceServer interface {
  Hello(context.Context, *String) (*String, error)
}
```

### 测试代码

服务端代码

```code
package main

import (
  "context"
  "google.golang.org/grpc"
  "log"
  "net"
)

type HelloServiceImpl struct{}

func (p *HelloServiceImpl) Hello(ctx context.Context, args *String) (*String, error) {
  reply := &String{Value: "hello:" + args.GetValue()}
  return reply, nil
}

func main() {
  grpcServer := grpc.NewServer()
  RegisterHelloServiceServer(grpcServer, new(HelloServiceImpl))
  lis, err := net.Listen("tcp", ":1234")
  if err != nil {
    log.Fatal(err)
  }
  grpcServer.Serve(lis)
}

```

客户端代码

```code
package main

import (
  "context"
  "fmt"
  "google.golang.org/grpc"
  "log"
)

func main() {
  conn, err := grpc.Dial("localhost:1234", grpc.WithInsecure())
  if err != nil {
    log.Fatal(err)
  }
  defer conn.Close()
  client := NewHelloServiceClient(conn)
  reply, err := client.Hello(context.Background(), &String{Value: "hello"})
  if err != nil {
    log.Fatal(err)
  }
  fmt.Println(reply.GetValue())
}

```

编译命令

```bash
go build gRPCServer.go hello.pb.go
go build gRPCClient.go hello.pb.go
```

输出

```text
hello:hello
```

## gRPC进阶

### gRPC流

### 发布和订阅模式

### 证书认证

### Token认证

### 截取器

## 链接

- [目录](directory.md)
- 上一节:[]
- 下一节:[]
